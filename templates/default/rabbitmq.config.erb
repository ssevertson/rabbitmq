%%%
%% Generated by Chef
%%%

[
  {kernel, [
<%= @kernel %> 
  ]},
<% if node['rabbitmq']['web_console']['use'] -%>
  {rabbitmq_management, [
    {listener, [
      {port, <%= node['rabbitmq']['web_console']['port'] %>},
  <% if node['rabbitmq']['web_console']['ip'] -%>
      {ip, "<%= node['rabbitmq']['web_console']['ip'] %>"}
  <% end%>
  <% if node['rabbitmq']['ssl']['use'] -%>
      ,
      {ssl, true},
      {ssl_opts, [
        {cacertfile,"<%= node['rabbitmq']['ssl']['cacert'] %>"},
        {certfile,"<%= node['rabbitmq']['ssl']['cert'] %>"},
        {keyfile,"<%= node['rabbitmq']['ssl']['key'] %>"},
        {ciphers, [
          {ecdhe_rsa,aes_128_cbc,sha256},
          {ecdhe_ecdsa,aes_128_cbc,sha256},
          {ecdhe_rsa,aes_128_cbc,sha},
          {ecdhe_ecdsa,aes_128_cbc,sha},
          {ecdhe_rsa,aes_256_cbc,sha384},
          {ecdhe_ecdsa,aes_256_cbc,sha384},
          {ecdhe_rsa,aes_256_cbc,sha},
          {ecdhe_ecdsa,aes_256_cbc,sha},
          {dhe_rsa,aes_128_cbc,sha256},
          {dhe_rsa,aes_128_cbc,sha},
          {dhe_rsa,aes_256_cbc,sha256}
          {dhe_rsa,aes_256_cbc,sha},
          {ecdhe_rsa,'3des_ede_cbc',sha},
          {ecdhe_ecdsa,'3des_ede_cbc',sha},
          {dhe_rsa,'3des_ede_cbc',sha},
          {rsa,aes_128_cbc,sha256},
          {rsa,aes_256_cbc,sha},
          {rsa,aes_128_cbc,sha},
          {rsa,aes_256_cbc,sha256},
          {rsa,'3des_ede_cbc',sha}
        ]}
      ]}
  <% end %>
    ]}
  ]},
<% end %>
  {rabbit, [
<% if node['rabbitmq']['cluster'] && node['rabbitmq']['cluster_disk_nodes'] -%>
    {cluster_nodes, {[<%= node['rabbitmq']['cluster_disk_nodes'].map{|n| "\'#{n}\'"}.join(',') %>], disc}},
    {cluster_partition_handling,<%= node['rabbitmq']['cluster_partition_handling'] %>},
<% end %>
<% if node['rabbitmq']['ssl']['use'] -%>
    {ssl_listeners, [<%= node['rabbitmq']['ssl']['port'] %>]},
    {ssl_options, [
      {cacertfile,"<%= node['rabbitmq']['ssl']['cacert'] %>"},
      {certfile,"<%= node['rabbitmq']['ssl']['cert'] %>"},
      {keyfile,"<%= node['rabbitmq']['ssl']['key'] %>"},
      {verify,<%= node['rabbitmq']['ssl']['verify'] %>},
      {fail_if_no_peer_cert,<%= node['rabbitmq']['ssl']['fail_if_no_peer_cert'] %>}]},
<% end %>
<% if node['rabbitmq']['ssl']['only'] -%>
    {tcp_listeners, []},
<% end %>
    {tcp_listen_options, [binary, {packet,<%= node['rabbitmq']['tcp_listen_packet'] %>},
                                  {reuseaddr,<%= node['rabbitmq']['tcp_listen_reuseaddr'] %>},
                                  {backlog,<%= node['rabbitmq']['tcp_listen_backlog'] %>},
                                  {nodelay,<%= node['rabbitmq']['tcp_listen_nodelay'] %>},
                                  {exit_on_close,<%= node['rabbitmq']['tcp_listen_exit_on_close'] %>},
                                  {keepalive,<%= node['rabbitmq']['tcp_listen_keepalive'] %>}]},
<% if node['rabbitmq']['disk_free_limit_relative'] -%>
    {disk_free_limit, {mem_relative, <%= node['rabbitmq']['disk_free_limit_relative'] %>}},
<% end %>
<% if node['rabbitmq']['vm_memory_high_watermark'] -%>
    {vm_memory_high_watermark, <%= node['rabbitmq']['vm_memory_high_watermark'] %>},
<% end %>
    {default_user, <<"<%= node['rabbitmq']['default_user'] %>">>},
    {default_pass, <<"<%= node['rabbitmq']['default_pass'] %>">>}
  ]}
].
